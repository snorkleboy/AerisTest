<h1 id="handling-mapbox-style-changes" class="page-title">Handling Mapbox Style Changes</h1>
<p>Render a basic interactive map using Mapbox with the ability to change the base map style.</p>
<p>When switching the base map style on a Mapbox map, existing layers and sources are often <a href="https://github.com/mapbox/mapbox-gl-js/issues/2267">removed from the map</a> and not re-added with the new style. The following example demonstrates how to re-add existing Aeris-related weather layers back onto a Mapbox map when changing the base map to a different style.</p>
<figure>
	<img src="/docs/js/img/awxjs-example-interactivemap-mapbox-basemap.png" alt="Mapbox interactive map example" />
	<figcaption>Mapbox interactive map example</figcaption>
</figure>
<pre class="language-html"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Aeris JavaScript SDK - Handling Mapbox Style Changes&lt;/title&gt;
    &lt;script defer src=&quot;https://cdn.aerisapi.com/sdk/js/latest/aerisweather.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.aerisapi.com/sdk/js/latest/aerisweather.css&quot;&gt;

    &lt;style&gt;
    body {
        font-family: &#39;Helvetica&#39;,&#39;Arial&#39;,sans-serif;
    }
    #map {
        height: 800px;
        margin: 10px auto 30px;
        width: 1000px;
    }
    .map-styles {
        font-size: 12px;
        text-align: center;
    }
    .map-styles &gt; a {
        border: 2px solid #ddd;
        color: #333;
        display: inline-block;
        font-weight: bold;
        margin: 0 2px;
        padding: 4px 8px;
        text-decoration: none;
    }
    .map-styles &gt; a:hover {
        background: #ddd;
        color: #333;
    }
    .map-styles &gt; a.selected {
        background: #333;
        border-color: #333;
        color: #fff;
    }
    &lt;/style&gt;

&lt;/head&gt;
&lt;body&gt;

&lt;p class=&quot;map-styles&quot;&gt;
    &lt;a href=&quot;#&quot; data-style=&quot;streets-v11&quot;&gt;Streets&lt;/a&gt;
    &lt;a href=&quot;#&quot; data-style=&quot;satellite-v9&quot;&gt;Satellite&lt;/a&gt;
    &lt;a href=&quot;#&quot; data-style=&quot;outdoors-v11&quot;&gt;Outdoors&lt;/a&gt;
    &lt;a href=&quot;#&quot; data-style=&quot;light-v10&quot;&gt;Light&lt;/a&gt;
    &lt;a href=&quot;#&quot; data-style=&quot;dark-v10&quot;&gt;Dark&lt;/a&gt;
&lt;/p&gt;
&lt;div id=&quot;map&quot;&gt;&lt;/div&gt;

&lt;script&gt;

    window.onload = () =&gt; {

        const aeris = new AerisWeather(&#39;CLIENT_ID&#39;, &#39;CLIENT_SECRET&#39;);
        const utils = aeris.utils;
        const $ = aeris.utils.$;
        let currentStyle = &#39;streets-v11&#39;;
        
        const setMapStyle = (map, type) =&gt; {
            if (type === currentStyle) return;

            currentStyle = type;

            // grab the existing style and cache all Aeris-related sources and layers
            // so they can be re-added after changing the map style
            const mapStyle = map.getStyle();
            const aerisLayers = mapStyle.layers.filter((layer) =&gt; /^aeris-/.test(layer.id));
            const aerisSources = Object.keys(mapStyle.sources).filter((key) =&gt; {
                return /^aeris-/.test(key);
            }).reduce((prev, result) =&gt; {
                prev[result] = mapStyle.sources[result];
                return prev;
            }, {});

            // need to wait for the new style to load before re-adding the previous map data
            map.on(&#39;style.load&#39;, () =&gt; {
                Object.keys(aerisSources).forEach((key) =&gt; {
                    const existing = map.getSource(key);
                    if (!existing) {
                        map.addSource(key, aerisSources[key]);
                    }
                });
                aerisLayers.forEach((layer) =&gt; {
                    const existing = map.getLayer(layer.id);
                    if (!existing) {
                        map.addLayer(layer)
                    }
                });
            });

            // update the map style
            map.setStyle(`mapbox://styles/mapbox/${type}`, { diff: true });
        };

        aeris.views().then(views =&gt; {
            const interactive = new views.InteractiveMap(&#39;#map&#39;, {
                strategy: &#39;mapbox&#39;,
                accessToken: &#39;MAPBOX_TOKEN&#39;,
                center: {
                    lat: 44.977,
                    lon: -88.265
                },
                zoom: 5,
                layers: &#39;satellite,alerts,radar,stormreports&#39;,
                timeline: {
                    from: -12 * 3600,
                    to: 0
                }
            });
            
            interactive.on(&#39;ready&#39;, () =&gt; {
                $(&#39;.map-styles &gt; a&#39;).on(&#39;click&#39;, (e) =&gt; {
                    e.preventDefault();
                    const $el = $(e.target);
                    $(&#39;.map-styles &gt; a&#39;).removeClass(&#39;selected&#39;);
                    $el.addClass(&#39;selected&#39;);

                    const type = $el.attr(&#39;data-style&#39;);
                    if (type) {
                        setMapStyle(interactive.map, type);
                    }
                });
                $(&#39;.map-styles &gt; a:nth-child(1)&#39;).click();
            });
        });

    };

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>